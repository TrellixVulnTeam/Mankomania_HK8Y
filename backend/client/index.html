<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>

<script type="module">
    import { io } from "https://cdn.socket.io/4.4.1/socket.io.esm.min.js";

    const socket = io('http://localhost:3000');
    //const socket = io('https://mankomania-backend.herokuapp.com');
    let lobby;

    socket.on("connect", () => {
        //clearDisplay()
       displayMessage(`You connected with id: ${socket.id}`)

    })

    socket.on("receive-message", message => {
        displayMessage(message)

    })

    socket.on('join-room', (room, id) =>{
        console.log(id)
        displayMessage(id + " joined " + room)
        lobby = room;
    })

    socket.on('startGame', (room, players) =>{
        displayMessage("Game starts " + room);
        console.log(players)

    })

    socket.on('ROLE_THE_DICE', () =>{
        displayMessage("Role the Dice")
    })



    const messageInput = document.getElementById("message");
    const roomInput = document.getElementById("room");

    const randomNumberButton = document.getElementById("randomNumber");
    const joinRoomButton = document.getElementById("joinRoom");
    const disconnectButton = document.getElementById("disconnect");
    const readyForGameButton = document.getElementById("readyForGame")
    const updateStockButton = document.getElementById("updateStock")

    updateStockButton.addEventListener("click", (event) =>{
        const stock = {
            HardSteel_PLC: 2,
            ShortCircuit_PLC: 2,
            DryOil_PLC : 2
        }
        socket.emit("choose_stocks", lobby, stock)
    })

    readyForGameButton.addEventListener("click", e=>{
        socket.emit('readyForGame', lobby)
    })

    disconnectButton.addEventListener("click", e =>{
        socket.disconnect();

    })

/*
    sendMessageButton.addEventListener("click", e => {
        e.preventDefault()
        const message = messageInput.value;
        const room = roomInput.value;

        if(message === "")return
        displayMessage(message);

        socket.emit('send-message', message, room);
        messageInput.value = "";

    })
    */
    randomNumberButton.addEventListener("click", e =>{
        let diceCount = randomNumber(1,7)
        displayMessage("DiceCount " + diceCount)
        socket.emit('ROLE_THE_HIGHEST_DICE', lobby, diceCount)
    })

    const randomNumber = (min, max)=>{
        return Math.floor(Math.random() * (max - min)) + min;
    }

    joinRoomButton.addEventListener("click", e => {
        const room = roomInput.value;
        /*
        socket.emit('join-room', room, message =>{
            displayMessage(message) //callback Function
        } )
        */
        socket.emit('join-room', room);
    })



    function displayMessage(message){
        const div = document.createElement("div")
        div.textContent = message;
        document.getElementById("txt").append(div);

    }

    function clearDisplay(){
        const div = document.createElement("div")
        div.empty();
    }
</script>

<style>

    .txt{
        border: 5px solid black;
        margin: 10px;
        font-size: large;
        height:300px;

    }

    .wrapper{
        display:grid;
        grid-template-columns: 1fr 1fr 1fr;
        margin: 10px;
    }
</style>


<div class="txt" id="txt">
</div>
<div class="wrapper">
    <div>Message</div>
    <div>
        <input type="text" id="message">
    </div>
    <div>
        <button type="button" id="randomNumber">Role the dice</button>
    </div>
    <div>Room</div>
    <div>
        <input type="text" id="room">
    </div>
    <div>
        <button class="btn" type="button" id="joinRoom">Join</button>
    </div>

    <div>
        <button class="btn" type="button" id="disconnect">Disconnect</button>
    </div>

    <div>
        <button class="btn" type="button" id="readyForGame">Ready for Game</button>
    </div>

    <div>
        <button class="btn" type="button" id="updateStock">update Stock</button>
    </div>

</div>



</body>
</html>
