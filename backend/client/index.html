<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>

<script type="module">
    import { io } from "https://cdn.socket.io/4.4.1/socket.io.esm.min.js";

    const socket = io('http://localhost:3000');
    //const socket = io('https://mankomania-backend.herokuapp.com');
    let lobby;
    let diceCounts = [];

    socket.on("connect", () => {
        //clearDisplay()
       displayMessage(`You connected with id: ${socket.id}`)

    })

    socket.on("receive-message", (message) => {
        console.log(message)

    })

    socket.on('JOIN_ROOM', (room, id) =>{
        console.log(id)
        displayMessage(id + " joined " + room)
        lobby = room;
    })

    socket.on('START_GAME', (room, players) =>{
        displayMessage("Game starts " + room);
        console.log(players)

    })

    socket.on('ROLE_THE_HIGHEST_DICE', () =>{
        diceCounts[0] = randomNumber(1,7)
        displayMessage("DiceCount 1: " + diceCounts[0])
        diceCounts[1] = randomNumber(1,7)
        displayMessage("DiceCount 2: " + diceCounts[1])
        socket.emit('ROLE_THE_HIGHEST_DICE', lobby, diceCounts)
    })

    socket.on('ROLE_THE_HIGHEST_DICE_AGAIN', (data,winner) =>{
        winner.forEach(o =>{
            if (o.socket === socket.id){
                let diceCount = randomNumber(1,7)
                displayMessage("DiceCount " + diceCount)
                socket.emit('ROLE_THE_HIGHEST_DICE_AGAIN', lobby, diceCount, winner.length)
            }
        })

    })

    socket.on('START_ROUND', (data, winner) =>{
        console.log(data)
        console.log(winner)
        displayMessage("Winner " +  winner)
    })



    const messageInput = document.getElementById("message");
    const roomInput = document.getElementById("room");

    const randomNumberButton = document.getElementById("randomNumber");
    const joinRoomButton = document.getElementById("joinRoom");
    const disconnectButton = document.getElementById("disconnect");
    const readyForGameButton = document.getElementById("readyForGame")
    const updateStockButton = document.getElementById("updateStock")

    updateStockButton.addEventListener("click", (event) =>{
        const stock = {
            HardSteel_PLC: 2,
            ShortCircuit_PLC: 0,
            DryOil_PLC : 0
        }
        socket.emit("CHOSE_STOCKS", lobby, stock)
    })

    readyForGameButton.addEventListener("click", e=>{
        socket.emit('READY_FOR_GAME', lobby)
    })

    disconnectButton.addEventListener("click", e =>{
        socket.disconnect();

    })

/*
    sendMessageButton.addEventListener("click", e => {
        e.preventDefault()
        const message = messageInput.value;
        const room = roomInput.value;

        if(message === "")return
        displayMessage(message);

        socket.emit('send-message', message, room);
        messageInput.value = "";

    })
    */
    randomNumberButton.addEventListener("click", e =>{
        diceCounts[0] = randomNumber(1,7)
        displayMessage("DiceCount 1: " + diceCounts[0])
        diceCounts[1] = randomNumber(1,7)
        displayMessage("DiceCount 2: " + diceCounts[1])
        socket.emit('ROLE_THE_HIGHEST_DICE', lobby, diceCounts)

    })



    const randomNumber = (min, max)=>{
        return Math.floor(Math.random() * (max - min)) + min;
    }



    joinRoomButton.addEventListener("click", e => {
        const room = roomInput.value;
        /*
        socket.emit('join-room', room, message =>{
            displayMessage(message) //callback Function
        } )
        */
        socket.emit('JOIN_ROOM', room);
    })



    function displayMessage(message){

        const div = document.createElement("div")
        div.textContent = message;
        document.getElementById("txt").append(div);

    }

    function clearDisplay(){
        const div = document.createElement("div")
        div.empty();
    }
</script>

<style>

    .txt{
        border: 5px solid black;
        margin: 10px;
        font-size: large;
        height:300px;

    }

    .wrapper{
        display:grid;
        grid-template-columns: 1fr 1fr 1fr;
        margin: 10px;
    }
</style>


<div class="txt" id="txt">
</div>
<div class="wrapper">
    <div>Message</div>
    <div>
        <input type="text" id="message">
    </div>
    <div>
        <button type="button" id="randomNumber">Role the dice 1</button>
    </div>

    <div>Room</div>
    <div>
        <input type="text" id="room">
    </div>
    <div>
        <button class="btn" type="button" id="joinRoom">Join</button>
    </div>

    <div>
        <button class="btn" type="button" id="disconnect">Disconnect</button>
    </div>

    <div>
        <button class="btn" type="button" id="readyForGame">Ready for Game</button>
    </div>

    <div>
        <button class="btn" type="button" id="updateStock">update Stock</button>
    </div>



</div>



</body>
</html>
